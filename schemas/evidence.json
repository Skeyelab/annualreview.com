{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/Skeyelab/annualreview.com/schemas/evidence.json",
  "title": "Evidence",
  "description": "Input contract for the annual-review pipeline: timeframe, optional role context, and flat contributions array. See AGENTS.md.",
  "type": "object",
  "required": ["timeframe", "contributions"],
  "properties": {
    "timeframe": {
      "type": "object",
      "properties": {
        "start_date": { "type": "string", "format": "date", "description": "YYYY-MM-DD" },
        "end_date": { "type": "string", "format": "date", "description": "YYYY-MM-DD" }
      },
      "required": ["start_date", "end_date"],
      "additionalProperties": false
    },
    "role_context_optional": {
      "type": ["object", "null"],
      "properties": {
        "level": { "type": "string" },
        "job_family": { "type": "string" },
        "focus_areas": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": false
    },
    "goals": {
      "type": "string",
      "description": "Optional annual goals provided by the user. Used as context to frame the review output."
    },
    "contributions": {
      "type": "array",
      "items": { "$ref": "#/definitions/contribution" }
    }
  },
  "additionalProperties": false,
  "definitions": {
    "contribution": {
      "type": "object",
      "required": ["id", "type", "title", "url"],
      "properties": {
        "id": { "type": "string", "description": "e.g. repo#1234, slack#C123#ts, jira#PROJ-1" },
        "type": {
          "type": "string",
          "enum": ["pull_request", "review", "release", "issue", "slack_message", "slack_thread", "jira_issue", "jira_comment"]
        },
        "source": {
          "type": "string",
          "enum": ["github", "slack", "jira", "linear"],
          "description": "Origin of this contribution. Defaults to 'github' for backward compatibility."
        },
        "title": { "type": "string" },
        "url": { "type": "string", "format": "uri" },
        "repo": { "type": "string", "description": "GitHub org/repo. Optional for non-GitHub sources." },
        "channel": { "type": "string", "description": "Slack channel name or ID (Slack source)." },
        "project": { "type": "string", "description": "Jira/Linear project key (Jira/Linear source)." },
        "meta": {
          "type": "object",
          "description": "Source-specific extra fields (e.g. Slack thread_ts, Jira issue key/status).",
          "additionalProperties": true
        },
        "merged_at": { "type": ["string", "null"], "format": "date-time" },
        "labels": {
          "type": "array",
          "items": { "type": "string" }
        },
        "files_changed": { "type": "number", "minimum": 0 },
        "additions": { "type": "number", "minimum": 0 },
        "deletions": { "type": "number", "minimum": 0 },
        "summary": { "type": "string" },
        "body": { "type": "string" },
        "linked_issues": {
          "type": "array",
          "items": { "type": "string" }
        },
        "review_comments_count": { "type": "number", "minimum": 0 },
        "approvals_count": { "type": "number", "minimum": 0 }
      },
      "additionalProperties": false
    }
  }
}
